{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽµ Neon Spotify Player</title>
    <link rel="stylesheet" href="{% static 'player/css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<div class="container">
    <h1>ðŸŽµ Neon Spotify Player</h1>

    <div class="player">
        <!-- Album Art -->
        <img id="album-art" src="{% static 'player/images/placeholder.png' %}" alt="Album Art">

        <p id="current-song">Select a song to play</p>

        <div class="audio-controls">
            <button id="prev-btn"><i class="fa fa-backward"></i></button>
            <button id="play-btn"><i class="fa fa-play"></i></button>
            <button id="next-btn"><i class="fa fa-forward"></i></button>
        </div>

        <div class="progress-container">
            <span id="current-time">0:00</span>
            <input type="range" id="progress" value="0" min="0" step="1">
            <span id="duration">0:00</span>
        </div>

        <div class="volume-container">
            <i class="fa fa-volume-down"></i>
            <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
            <i class="fa fa-volume-up"></i>
        </div>

        <audio id="audio-player"></audio>

        <ul class="song-list">
            {% for song in songs %}
                <li class="song-item" onclick="selectSong({{ forloop.counter0 }})">
                    {{ song.name }} - {{ song.artist }}
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
const songs = [
    {% for song in songs %}
    {
        name: "{{ song.name }}",
        artist: "{{ song.artist }}",
        path: "{{ song.preview_url }}",
        art: "{{ song.album_art }}"
    },
    {% endfor %}
];

const audioPlayer = document.getElementById('audio-player');
const albumArt = document.getElementById('album-art');
const currentSongText = document.getElementById('current-song');
const playBtn = document.getElementById('play-btn');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const progress = document.getElementById('progress');
const currentTimeEl = document.getElementById('current-time');
const durationEl = document.getElementById('duration');
const volumeSlider = document.getElementById('volume');

let currentIndex = null;
let isPlaying = false;

function selectSong(index) {
    currentIndex = index;
    audioPlayer.src = songs[index].path;
    albumArt.src = songs[index].art;
    currentSongText.textContent = `Now Playing: ${songs[index].name} - ${songs[index].artist}`;
    audioPlayer.play();
    isPlaying = true;
    playBtn.innerHTML = '<i class="fa fa-pause"></i>';
    albumArt.classList.add('rotate');
}

playBtn.addEventListener('click', () => {
    if (!audioPlayer.src) return;
    if (isPlaying) {
        audioPlayer.pause();
        playBtn.innerHTML = '<i class="fa fa-play"></i>';
        albumArt.classList.remove('rotate');
    } else {
        audioPlayer.play();
        playBtn.innerHTML = '<i class="fa fa-pause"></i>';
        albumArt.classList.add('rotate');
    }
    isPlaying = !isPlaying;
});

prevBtn.addEventListener('click', () => {
    if (currentIndex === null) return;
    currentIndex = (currentIndex - 1 + songs.length) % songs.length;
    selectSong(currentIndex);
});

nextBtn.addEventListener('click', () => {
    if (currentIndex === null) return;
    currentIndex = (currentIndex + 1) % songs.length;
    selectSong(currentIndex);
});

audioPlayer.addEventListener('timeupdate', () => {
    progress.max = audioPlayer.duration || 0;
    progress.value = audioPlayer.currentTime || 0;

    let minutes = Math.floor(audioPlayer.currentTime / 60) || 0;
    let seconds = Math.floor(audioPlayer.currentTime % 60) || 0;
    if (seconds < 10) seconds = '0' + seconds;
    currentTimeEl.textContent = `${minutes}:${seconds}`;

    if (audioPlayer.duration) {
        let dMinutes = Math.floor(audioPlayer.duration / 60);
        let dSeconds = Math.floor(audioPlayer.duration % 60);
        if (dSeconds < 10) dSeconds = '0' + dSeconds;
        durationEl.textContent = `${dMinutes}:${dSeconds}`;
    }
});

progress.addEventListener('input', () => {
    audioPlayer.currentTime = progress.value;
});

volumeSlider.addEventListener('input', () => {
    audioPlayer.volume = volumeSlider.value;
});
</script>
</body>
</html>
